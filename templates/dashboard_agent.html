{% extends "base.html" %}
{% block content %}
<section class="section" style="background:#1e1e2f; min-height:100vh; color:#f8f9fc;">
  <div class="dashboard-container" style="max-width:1200px; margin:0 auto; padding:2rem 1rem;">

    <!-- Header -->
    <div style="display:flex;flex-direction:column;align-items:center;justify-content:center;margin-bottom:1.5rem;">
      <h1 class="title is-2" style="color:#f8f9fc;">Agent Dashboard</h1>
      <p class="subtitle" style="color:rgba(248,249,252,0.85);">Pay or recharge a customer by ID</p>
    </div>

    <!-- Payment Card (centered, full-width up to 600px) -->
<div style="display:flex; justify-content:center; margin-bottom:1.5rem;">
  <div class="card p-5" style="background:#2b2b3d; width:90%; height:28%; border-radius:10px; border:1px solid rgba(255,255,255,0.06);">
    <form method="post" action="{{ url_for('agent_pay') }}">
      
      <!-- Customer ID Field -->
      <div class="field">
        <label class="label" style="color:#fff; width:100%; height:14%;">Customer ID</label>
        <div class="control">
          <input class="input form-input" name="user_id" type="number" placeholder="Enter customer ID" required style="width:100%;">
        </div>
      </div>

      <!-- Amount Field -->
      <div class="field">
        <label class="label" style="color:#fff; width:100%; height:14%;">Amount</label>
        <div class="control">
          <input class="input form-input" name="amount" type="number" step="0.01" placeholder="Enter amount" required style="width:100%;">
        </div>
      </div>

      <!-- Submit Button -->
      <div class="field is-grouped is-justify-content-center" style="margin-top:1rem;">
        <div class="control">
          <button class="button btn-primary is-medium" type="submit" style="background:#4e73df; color:#fff; border:none; width:100%;">Submit Payment / Recharge</button>
        </div>
      </div>
    </form>
  </div>
</div>


    <!-- Bills Table -->
    <div style="display:flex;flex-direction:column;align-items:center;">
      <h3 class="title is-4" style="color:#f8f9fc; margin-bottom:0.75rem;">Bills</h3>

      <div class="table-container" style="background:#2b2b3d; width:100%; max-width:980px; border-radius:10px; padding:0.5rem; border:1px solid rgba(255,255,255,0.06);">
        <div style="overflow-x:auto;">
          <table class="table is-fullwidth is-hoverable" style="background:transparent; color:#fff; border-radius:8px; table-layout: fixed; width: 100%;">
            <thead style="background:#383851;">
              <tr>
                <th style="width:20%; text-align:center;">Bill ID</th>
                <th style="width:20%; text-align:center;">Customer ID</th>
                <th style="width:20%; text-align:center;">Amount</th>
                <th style="width:20%; text-align:center;">Status</th>
                <th style="width:20%; text-align:center;">Due Date</th>
              </tr>
            </thead>
            <tbody>
              {% for b in bills %}
              <tr>
                <!-- Mongo ObjectId can be printed; convert to string if needed -->
                <td style="text-align:center; font-family:monospace;">{{ b.get('_id') }}</td>

                <!-- Your backend uses 'id' as the customer id -->
                <td style="text-align:center;">{{ b.get('id') }}</td>

                <!-- Amount present in backend as 'amount' -->
                <td style="text-align:center;">${{ "%.2f"|format(b.get('amount', 0)) }}</td>

                <td style="text-align:center;">
                  {% set st = b.get('status','unpaid') %}
                  {% if st == 'paid' %}
                    <span class="tag is-success">{{ st }}</span>
                  {% elif st == 'replaced' %}
                    <span class="tag" style="background:#ffdd57; color:#222;">{{ st }}</span>
                  {% else %}
                    <span class="tag is-danger">{{ st }}</span>
                  {% endif %}
                </td>

                <!-- Optional due date -->
                <td style="text-align:center;">{{ b.get('due_date') or '-' }}</td>
              </tr>
              {% else %}
              <tr>
                <td colspan="5" style="text-align:center; color:rgba(255,255,255,0.6);">No bills found.</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>

  </div>
</section>

<style>
  .form-input {
    background:#3a3a4f;
    border:1px solid rgba(255,255,255,0.08);
    color:#f8f9fc;
  }
  .btn-primary { background:#4e73df; color:white; }
  table th, table td { text-align:center !important; vertical-align:middle !important; }
  /* keep responsive spacing */
  @media (max-width: 768px) {
    .card { max-width: 100%; padding:1rem; }
    .table-container { max-width: 100%; padding:0.25rem; }
  }
</style>
{% endblock %}
